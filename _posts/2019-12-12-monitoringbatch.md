---
title: "티켓 사용처리 모니터링 배치 컨셉"
date: 2019-12-12
categories: java
---

전에 작업했던 모니터링 데이터는 문서가 티켓단위라 너무 작게 쪼개지는 부분이 있어, 시간단위로 문서를 생성하고 거기에 실패한 티켓 정보를 모으는 것으로 수정하려 한다.  
(최소 메타데이터는 메모리에 올라가게 되는데, 문서 단위가 너무 작으면 메모리 사용에 불합리한 부분이 있어 문서 사이즈를 키워보려고 한다. 실제 데이터는 얼마 되지 않긴 하겠지만..)  
  
시간단위로 도큐먼트를 생성하고, 날짜와 시간을 도큐먼트ID로 만든다.  
도큐먼트가 있으면 데이터를 업데이트하고, 없으면 생성해야 하는데, 매번 도큐먼트가 있는지 조회하기는 애매하므로  
일단 데이터를 업데이트 하고 성공건수를 리턴받아서 리턴값이 0이면 도큐먼트가 생성되지 않았다는 뜻이니 이 때에는 문서를 새로 생성하기로 한다.
